(function(){var ar={_cache:{},pattern:{punct:"[!-/:-@\\[\\\\\\]-`{-~]",space:"\\s"},escape:function(av){return av.replace(/[\-\[\]\{\}\(\)\*\+\?\.\,\\\^\$\|\#\s]/g,"\\$&");},collapse:function(av){return av.replace(/(?:#.*?(?:\n|$))/g,"").replace(/\s+/g,"");},expand_patterns:function(av){return av.replace(/\[\:\s*(\w+)\s*\:\]/g,function(aw,ax){return(ax in ar.pattern)?ar.expand_patterns(ar.pattern[ax]):ax;});},isRegExp:function(av){return Object.prototype.toString.call(av)==="[object RegExp]";},compile:function(ay,av){if(ar.isRegExp(ay)){if(arguments.length===1){av=(ay.global?"g":"")+(ay.ignoreCase?"i":"")+(ay.multiline?"m":"");}ay=ay.source;}var aw=ay+(av||"");if(aw in ar._cache){return ar._cache[aw];}var ax=ar.expand_patterns(ay);if(av&&/x/.test(av)){ax=ar.collapse(ax);}if(av&&/s/.test(av)){ax=ax.replace(/([^\\])\./g,"$1[^\\0]");}av=(av||"").replace(/[^gim]/g,"");return(ar._cache[aw]=new RegExp(ax,av));}};var J={escape:function(aw,av){return aw.replace(/&(?!(#\d{2,}|#x[\da-fA-F]{2,}|[a-zA-Z][a-zA-Z1-4]{1,6});)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,av?"&quot;":'"').replace(/'/g,av?"&#39;":"'");},toHTML:function(aA){aA=aA.concat();if(typeof aA==="string"){return J.escape(aA);}var av=aA.shift(),ax={},ay=[],az="",aw;if(aA.length&&typeof aA[0]==="object"&&!Array.isArray(aA[0])){ax=aA.shift();}while(aA.length){ay.push(J.toHTML(aA.shift()));}for(aw in ax){az+=" "+aw+'="'+J.escape(ax[aw],true)+'"';}if(av=="!"){return"<!--"+ay.join("")+"-->";}else{if(av=="img"||av=="br"||av=="hr"){return"<"+av+az+" />";}else{return"<"+av+az+">"+ay.join("")+"</"+av+">";}}}};var N={};function g(av){N={};}var r=Array.isArray||function(av){return Object.prototype.toString.call(av)==="[object Array]";};ar.pattern.blocks="(?:b[qc]|div|notextile|pre|h[1-6]|fn\\d+|p|###)";ar.pattern.pba_class="\\([^\\)]+\\)";ar.pattern.pba_style="\\{[^\\}]+\\}";ar.pattern.pba_lang="\\[[^\\[\\]]+\\]";ar.pattern.pba_align="(?:<>|<|>|=)";ar.pattern.pba_pad="[\\(\\)]+";ar.pattern.pba_attr="(?:[:pba_class:]|[:pba_style:]|[:pba_lang:]|[:pba_align:]|[:pba_pad:])*";ar.pattern.url_punct="[.,«»″‹›!?]";ar.pattern.html_id="[a-zA-Z][a-zA-Z\\d:]*";ar.pattern.html_attr="(?:\"[^\"]+\"|'[^']+'|[^>\\s]+)";ar.pattern.tx_urlch='[\\w"$\\-_.+!*\'(),";\\/?:@=&%#{}|\\\\^~\\[\\]`]';ar.pattern.tx_cite=":((?:[^\\s()]|\\([^\\s()]+\\)|[()])+?)(?=[!-\\.:-@\\[\\\\\\]-`{-~]+(?:$|\\s)|$|\\s)";ar.pattern.ucaps="A-Z\u00c0-\u00d6\u00d8-\u00de\u0100\u0102\u0104\u0106\u0108\u010a\u010c\u010e\u0110\u0112\u0114\u0116\u0118\u011a\u011c\u011e\u0120\u0122\u0124\u0126\u0128\u012a\u012c\u012e\u0130\u0132\u0134\u0136\u0139\u013b\u013d\u013f\u0141\u0143\u0145\u0147\u014a\u014c\u014e\u0150\u0152\u0154\u0156\u0158\u015a\u015c\u015e\u0160\u0162\u0164\u0166\u0168\u016a\u016c\u016e\u0170\u0172\u0174\u0176\u0178\u0179\u017b\u017d\u0181\u0182\u0184\u0186\u0187\u0189-\u018b\u018e-\u0191\u0193\u0194\u0196-\u0198\u019c\u019d\u019f\u01a0\u01a2\u01a4\u01a6\u01a7\u01a9\u01ac\u01ae\u01af\u01b1-\u01b3\u01b5\u01b7\u01b8\u01bc\u01c4\u01c7\u01ca\u01cd\u01cf\u01d1\u01d3\u01d5\u01d7\u01d9\u01db\u01de\u01e0\u01e2\u01e4\u01e6\u01e8\u01ea\u01ec\u01ee\u01f1\u01f4\u01f6-\u01f8\u01fa\u01fc\u01fe\u0200\u0202\u0204\u0206\u0208\u020a\u020c\u020e\u0210\u0212\u0214\u0216\u0218\u021a\u021c\u021e\u0220\u0222\u0224\u0226\u0228\u022a\u022c\u022e\u0230\u0232\u023a\u023b\u023d\u023e\u0241\u0243-\u0246\u0248\u024a\u024c\u024e\u1e00\u1e02\u1e04\u1e06\u1e08\u1e0a\u1e0c\u1e0e\u1e10\u1e12\u1e14\u1e16\u1e18\u1e1a\u1e1c\u1e1e\u1e20\u1e22\u1e24\u1e26\u1e28\u1e2a\u1e2c\u1e2e\u1e30\u1e32\u1e34\u1e36\u1e38\u1e3a\u1e3c\u1e3e\u1e40\u1e42\u1e44\u1e46\u1e48\u1e4a\u1e4c\u1e4e\u1e50\u1e52\u1e54\u1e56\u1e58\u1e5a\u1e5c\u1e5e\u1e60\u1e62\u1e64\u1e66\u1e68\u1e6a\u1e6c\u1e6e\u1e70\u1e72\u1e74\u1e76\u1e78\u1e7a\u1e7c\u1e7e\u1e80\u1e82\u1e84\u1e86\u1e88\u1e8a\u1e8c\u1e8e\u1e90\u1e92\u1e94\u1e9e\u1ea0\u1ea2\u1ea4\u1ea6\u1ea8\u1eaa\u1eac\u1eae\u1eb0\u1eb2\u1eb4\u1eb6\u1eb8\u1eba\u1ebc\u1ebe\u1ec0\u1ec2\u1ec4\u1ec6\u1ec8\u1eca\u1ecc\u1ece\u1ed0\u1ed2\u1ed4\u1ed6\u1ed8\u1eda\u1edc\u1ede\u1ee0\u1ee2\u1ee4\u1ee6\u1ee8\u1eea\u1eec\u1eee\u1ef0\u1ef2\u1ef4\u1ef6\u1ef8\u1efa\u1efc\u1efe\u2c60\u2c62-\u2c64\u2c67\u2c69\u2c6b\u2c6d-\u2c70\u2c72\u2c75\u2c7e\u2c7f\ua722\ua724\ua726\ua728\ua72a\ua72c\ua72e\ua732\ua734\ua736\ua738\ua73a\ua73c\ua73e\ua740\ua742\ua744\ua746\ua748\ua74a\ua74c\ua74e\ua750\ua752\ua754\ua756\ua758\ua75a\ua75c\ua75e\ua760\ua762\ua764\ua766\ua768\ua76a\ua76c\ua76e\ua779\ua77b\ua77d\ua77e\ua780\ua782\ua784\ua786\ua78b\ua78d\ua790\ua792\ua7a0\ua7a2\ua7a4\ua7a6\ua7a8\ua7aa";var q=ar.compile(/^([:blocks:])/),W=ar.compile(/^[:blocks:]$/),y=ar.compile(/^(.+?)($|\n(?:\s*\n|$)+)/,"s"),Q=ar.compile(/^(.+?)($|\n+(?=[:blocks:][:pba_attr:]\.))/,"s"),m=/^(\-\-\-+|\*\*\*+|___+)(\n\s+|$)/,ac=/^((?:[\t ]*[\#\*]+[\(\)\{\[\s\.]+.+?(?:\n|$))+)(\s*\n)?/,ab=/^([\#\*]+)(.+?)(\n|$)/,H=ar.compile(/^((?:table[:pba_attr:]\.\n)?(?:(?:[:pba_attr:]\.[^\n\S]*)?\|.*?\|[^\n\S]*(?:\n|$))+)([^\n\S]*\n)?/,"s"),l=/^table(_?)([^\n]+)\.\s?\n/,T=ar.compile(/^([:pba_attr:]\.[^\n\S]*)?\|(.*?)\|[^\n\S]*(\n|$)/,"s"),M=/^\[(__?|\*\*?|\?\?|[\-\+\^~@%])([^\n]+)\1\]/,s=/^([\[\{]?)(__?|\*\*?|\?\?|[\-\+\^~@%])/,w=ar.compile(/^.+?(?=[\\<!\[_\*`]|\n|$)/,"s"),ae=ar.compile(/^!(?!\s)([:pba_attr:](?:\.[^\n\S]|\.(?:[^\.\/]))?)([^!\s]+?) ?(?:\(((?:[^\(]+|\([^\(\)]+\))+)\))?!(?::([^\s]+?(?=[!-\.:-@\[\\\]-`{-~](?:$|\s)|\s|$)))?/),u=ar.compile(/^\[!(?!\s)([:pba_attr:](?:\.[^\n\S]|\.(?:[^\.\/]))?)([^!\s]+?) ?(?:\(((?:[^\(]+|\([^\(\)]+\))+)\))?!(?::([^\s]+?(?=[!-\.:-@\[\\\]-`{-~](?:$|\s)|\s|$)))?\]/),v=ar.compile(/^((?!TM\)|tm\))[[:ucaps:]](?:[[:ucaps:]\d]{1,}(?=\()|[[:ucaps:]\d]{2,}))(?:\((.*?)\))?(?=\W|$)/),S=ar.compile(/^"(?!\s)((?:[^\n"]|"(?![\s:])[^\n"]+"(?!:))+)"[:tx_cite:]/),Y=/^\["([^\n]+?)":((?:\[[a-z0-9]*\]|[^\]])+)\]/,U=ar.compile(/^\[([^\]]+)\]((?:https?:\/\/|\/)\S+)(?:\s*\n|$)/),B=/\s*\(((?:\([^\(\)]*\)|[^\(\)]+)+)\)$/,am=/^fn\d+$/,o=/^\[(\d+)\]/,aa=ar.compile(/^\s*<([:html_id:](?::[a-zA-Z\d]+)*)((?:\s[^=\s\/]+(?:\s*=\s*[:html_attr:])?)+)?\s*(\/?)>(\n*)/),aq=ar.compile(/^<([:html_id:])((?:\s[^=\s\/]+(?:\s*=\s*[:html_attr:])?)+)?\s*(\/?)>(\n*)/),i=ar.compile(/^<!--(.+?)-->/,"s"),ag=ar.compile(/^<\/([:html_id:])([^>]*)>/),p=ar.compile(/^\s*([^=\s]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/),an=/&(#\d\d{2,}|#x[\da-fA-F]{2,}|[a-zA-Z][a-zA-Z1-4]{1,6});/,z=/([\d\.,]+['"]? ?)x( ?)(?=[\d\.,]['"]?)/g,n=/(^|[\s\w])--([\s\w]|$)/g,a=/(\b ?|\s|^)(?:\((?:TM|tm)\)|\[(?:TM|tm)\])/g,ap=/(\b ?|\s|^)(?:\(R\)|\[R\])/gi,at=/(\b ?|\s|^)(?:\(C\)|\[C\])/gi,C=/(\w)\'(\w)/g,af=ar.compile(/(\d*[\.,]?\d+)"(?=\s|$|[:punct:])/g),I=ar.compile(/(\d*[\.,]?\d+)'(?=\s|$|[:punct:])/g),ad=ar.compile(/([^\s\[\(])"(?=$|\s|[:punct:])/g),b=ar.compile(/([^\s\[\(])'(?=$|\s|[:punct:])/g),ah=/^\(([^\(\)\n]+)\)/,F=/^([\(]+)/,D=/^([\)]+)/,ao=/^(<>|<|>|=)/,K=/^(<|>|=)/,X=/^(~|\^|\-)/,P=/^\\(\d+)/,aj=/^\/(\d+)/,j=/^\{([^\}]*)\}/,e=/^\s*([^:\s]+)\s*:\s*(.+)\s*$/,x=/^\[([^\[\]]+)\]/;var al={"*":"strong","**":"b","??":"cite",_:"em",__:"i","-":"del","%":"span","+":"ins","~":"sub","^":"sup","@":"code"};var ai={br:1,hr:1,img:1,link:1,meta:1,wbr:1,area:1,param:1,input:1,option:1,base:1};var E={"<":"left","=":"center",">":"right","<>":"justify"};var L={"~":"bottom","^":"top","-":"middle"};var c={p:0,hr:0,ul:1,ol:0,li:0,div:1,pre:0,object:1,script:0,noscript:0,blockquote:1,notextile:1};function ak(av){var aw=null,ay=av+"",ax=0;return{save:function(){aw=ax;},load:function(){ax=aw;av=ay.slice(ax);},advance:function(az){ax+=(typeof az==="string")?az.length:az;return(av=ay.slice(ax));},lookbehind:function(az){az=az==null?1:az;return ay.slice(ax-az,ax);},startsWith:function(az){return av.substring(0,az.length)===az;},valueOf:function(){return av;},toString:function(){return av;}};}function R(av){var aw=r(av)?av:[];return{add:function(ax){if(typeof ax==="string"&&typeof aw[aw.length-1]==="string"){aw[aw.length-1]+=ax;}else{if(r(ax)){var ay=ax.filter(function(az){return az!==undefined;});aw.push(ay);}else{if(ax){aw.push(ax);}}}return this;},merge:function(az){for(var ay=0,ax=az.length;ay<ax;ay++){this.add(az[ay]);}return this;},linebreak:function(){if(aw.length){this.add("\n");}},get:function(){return aw;}};}function V(ax,aw){if(!ax){return undefined;}var av,ay={};for(av in ax){if(av in ax&&(!aw||!(av in aw))){ay[av]=ax[av];}}return ay;}function O(aw){var ay={},av,ax;while((av=p.exec(aw))){ay[av[1]]=(typeof av[2]==="string")?av[2].replace(/^(["'])(.*)\1$/,"$2"):null;aw=aw.slice(av[0].length);}return ay;}function d(av,aC){var aJ=av+"",aB=[],aE=aB,aH=[],aw,az=aC?function(aK){return aK in aC;}:function(){return true;},aI;av=(typeof av==="string")?ak(av):av;do{if((aw=i.exec(av))&&az("!")){av.advance(aw[0]);aB.push(["!",aw[1]]);}else{if((aw=ag.exec(av))&&az(aw[1])){aI=aw[1];var aG=aw[2];if(aH.length){for(var ay=aH.length-1;ay>=0;ay--){var aD=aH[ay];if(aD[0]===aI){aH.splice(ay);aB=aH[aH.length-1]||aE;break;}}}av.advance(aw[0]);}else{if((aw=aq.exec(av))&&az(aw[1])){av.advance(aw[0]);aI=aw[1];var aF=aw[3]||aw[1] in ai,aA=aw[4],ax=[aI];if(aw[2]){ax.push(O(aw[2]));}if(aF){aB.push(ax);if(aA){aB.push(aA);}}else{if(aA){ax.push(aA);}aH.push(ax);aB.push(ax);aB=ax;}}else{aw=/([^<]+|[^\0])/.exec(av);if(aw){aB.push(aw[0]);}av.advance(aw?aw[0].length||1:1);}}}}while(av.valueOf());return aE;}function Z(aF,az,aB){aF+="";if(!aF||az==="notextile"){return undefined;}var ax,aJ={},aw={style:aJ},ay=aF,av=az==="table"||az==="td"||W.test(az),aH=az==="img",aA=!av&&!aH&&az!=="a",aE=(aH)?K:ao;do{if((ax=j.exec(ay))){ax[1].split(";").forEach(function(aL){var aM=aL.match(e);if(aM){aJ[aM[1]]=aM[2];}});ay=ay.slice(ax[0].length);continue;}if((ax=x.exec(ay))){aw.lang=ax[1];ay=ay.slice(ax[0].length);continue;}if((ax=ah.exec(ay))){var aD=ay.slice(ax[0].length);if((!aD&&aA)||(aB&&(aD[0]===" "||aB===aD.slice(0,aB.length)))){ax=null;continue;}var aI=ax[1].split("#");if(aI[0]){aw["class"]=aI[0];}if(aI[1]){aw.id=aI[1];}ay=aD;continue;}if(av){if((ax=F.exec(ay))){aJ["padding-left"]=(ax[1].length)+"em";ay=ay.slice(ax[0].length);continue;}if((ax=D.exec(ay))){aJ["padding-right"]=(ax[1].length)+"em";ay=ay.slice(ax[0].length);continue;}}if(aH||av){if((ax=aE.exec(ay))){var aC=E[ax[1]];if(aH){aw.align=aC;}else{aJ["text-align"]=aC;}ay=ay.slice(ax[0].length);continue;}}if(az==="td"||az==="tr"){if((ax=X.exec(ay))){aJ["vertical-align"]=L[ax[1]];ay=ay.slice(ax[0].length);continue;}}if(az==="td"){if((ax=P.exec(ay))){aw.colspan=ax[1];ay=ay.slice(ax[0].length);continue;}if((ax=aj.exec(ay))){aw.rowspan=ax[1];ay=ay.slice(ax[0].length);continue;}}}while(ax);var aK=[];for(var aG in aJ){aK.push(aG+":"+aJ[aG]);}if(aK.length){aw.style=aK.join(";");}else{delete aw.style;}return ay==aF?undefined:[aF.length-ay.length,aw];}function A(av){if(typeof av!=="string"){return av;}return av.replace(/([^\-]|^)->/,"$1&#8594;").replace(z,"$1&#215;$2").replace(/([^.]?)\.{3}/g,"$1&#8230;").replace(n,"$1&#8212;$2").replace(/( )-( )/g,"$1&#8211;$2").replace(a,"$1&#8482;").replace(ap,"$1&#174;").replace(at,"$1&#169;").replace(af,"$1&#8243;").replace(ad,"$1&#8221;").replace(/"/g,"&#8220;").replace(I,"$1&#8242;").replace(C,"$1&#8217;$2").replace(b,"$1&#8217;").replace(/'/g,"&#8216;");}function G(aw){aw=ak(aw.replace(/(^|\n)[\t ]+/,"$1"));var ay=function(aK){var aJ="\n";while(aK--){aJ+="\t";}return aJ;},aF=[],az,aI;while((az=ab.exec(aw))){var aH=["li"],ax=Z(az[2],"li");if(ax){az[2]=az[2].slice(ax[0]);ax=ax[1];}var aA=az[1].length,aE=az[1].substr(-1)==="#"?"ol":"ul",aG=aF.length===aA,aC=null,aB,aD,av;while(aF.length<aA){aB=[aE,ay(aF.length+1),(aC=["li"])];aD=aF[aF.length-1];if(aD){aD.li.push(ay(aF.length));aD.li.push(aB);}aF.push({ul:aB,li:aC});}while(aF.length>aA){av=aF.pop();av.ul.push(ay(aF.length));}aD=aF[aF.length-1];if(!aC){aD.ul.push(ay(aF.length),aH);aD.li=aH;}if(ax){aD.li.push(ax);}Array.prototype.push.apply(aD.li,k(az[2].trim()));aw.advance(az[0]);}while(aF.length){aI=aF.pop();aI.ul.push(ay(aF.length));}return aI.ul;}function au(av){av=ak(av.trim());var aD=["table"],aE,aF,aw,aA,ay;if((ay=l.exec(av))){av.advance(ay[0]);aw=Z(ay[2],"table");if(aw){aD.push(aw[1]);}}while((ay=T.exec(av))){aE=["tr"];if(ay[1]&&(aw=Z(ay[1],"tr"))){aE.push(aw[1]);}aD.push("\n\t",aE);aF=ak(ay[2]);do{aF.save();var ax=aF.startsWith("_"),aC=[ax?"th":"td"];if(ax){aF.advance(1);}aw=Z(aF,"td");if(aw){aF.advance(aw[0]);aC.push(aw[1]);}if(aw||ax){var az=/^\.\s*/.exec(aF);if(az){aF.advance(az[0]);}else{aC=["td"];aF.load();}}var aB=/^(==.*?==|[^\|])*/.exec(aF);aC=aC.concat(k(aB[0]));aE.push("\n\t\t",aC);aA=aF.valueOf().charAt(aB[0].length)==="|";aF.advance(aB[0].length+1);}while(aA);aE.push("\n\t");av.advance(ay[0]);}aD.push("\n");return aD;}function k(aD){aD=ak(aD);var aM=R(),aK,aB;do{aD.save();if(aD.startsWith("\n")){aD.advance(1);aM.add(["br"]);aM.add("\n");continue;}if((aK=/^==(.*?)==/.exec(aD))){aD.advance(aK[0]);aM.add(aK[1]);continue;}var az=aD.lookbehind(1);var aL=!az||/^[\s>.,"'?!;:()]$/.test(az);if((aK=s.exec(aD))&&(aL||aK[1])){aD.advance(aK[0]);var aI=aK[2],aF=aK[1],av=al[aI],aw=av==="code";if((aB=!aw&&Z(aD,av,aI))){aD.advance(aB[0]);aB=aB[1];}var aC;var aH;if(aF==="["){aC="^(.*?)";aH="(?:])";}else{if(aF==="{"){aC="^(.*?)";aH="(?:})";}else{var aG=ar.escape(aI.charAt(0));aC="^([^\\s"+aG+"]+|[^\\s"+aG+"].*?\\S("+aG+"*))";aH="(?=$|[\\s.,\"'!?;:()«»„“”‚‘’])";}}var aA=ar.compile(aC+"("+ar.escape(aI)+")"+aH);if((aK=aA.exec(aD))&&aK[1]){aD.advance(aK[0]);if(aw){aM.add([av,aK[1]]);}else{aM.add([av,aB].concat(k(aK[1])));}continue;}aD.load();}if((aK=ae.exec(aD))||(aK=u.exec(aD))){aD.advance(aK[0]);aB=aK[1]&&Z(aK[1],"img");var aJ=aB?aB[1]:{src:""},aS=["img",aJ];aJ.src=aK[2];aJ.alt=aK[3]?(aJ.title=aK[3]):"";if(aK[4]){aS=["a",{href:aK[4]},aS];}aM.add(aS);continue;}if((aK=i.exec(aD))){aD.advance(aK[0]);aM.add(["!",aK[1]]);continue;}if((aK=aq.exec(aD))){aD.advance(aK[0]);var aR=aK[1],aN=aK[3]||aK[1] in ai,ay=[aR],aE=aK[4];if(aK[2]){ay.push(O(aK[2]));}if(aN){aM.add(ay).add(aE);continue;}else{var aQ=ar.compile("^(.*?)(</"+aR+"\\s*>)","s");if((aK=aQ.exec(aD))){aD.advance(aK[0]);if(aR==="code"){ay.push(aE,aK[1]);}else{if(aR==="notextile"){aM.merge(k(aK[1]));continue;}else{ay=ay.concat(k(aK[1]));}}aM.add(ay);continue;}}aD.load();}if((aK=o.exec(aD))){aD.advance(aK[0]);aM.add(["sup",{"class":"footnote",id:"fnr"+aK[1]},["a",{href:"#fn"+aK[1]},aK[1]]]);continue;}if((aK=v.exec(aD))){aD.advance(aK[0]);var ax=["span",{"class":"caps"},aK[1]];if(aK[2]){ax=["acronym",{title:aK[2]},ax];}aM.add(ax);continue;}if((aL&&(aK=S.exec(aD)))||(aK=Y.exec(aD))){aD.advance(aK[0].length);var aP=aK[1].match(B),aO=(aP)?aK[1].slice(0,aK[1].length-aP[0].length):aK[1];if((aB=Z(aO,"a"))){aO=aO.slice(aB[0]);aB=aB[1];}else{aB={};}if(aP&&!aO){aO=aP[0];aP="";}aB.href=aK[2];if(aP){aB.title=aP[1];}aM.add(["a",aB].concat(k(aO.replace(/^(\.?\s*)/,""))));continue;}aK=/([a-zA-Z0-9,.':]+|\s+|[^\0])/.exec(aD);if(aK){aM.add(aK[0]);}aD.advance(aK?aK[0].length||1:1);}while(aD.valueOf());return aM.get().map(A);}function t(av){var aG=R(),aD=function(aQ,aM,aN,aP){aM=aM||"p";var aO=[];aQ.split(/\n\n+/).forEach(function(aS,aR){if(aM==="p"&&/^\s/.test(aS)){aS=aS.replace(/\n[\t ]/g," ").trim();aO=aO.concat(k(aS));}else{if(aP&&aR){aO.push(aP);}aO.push(aN?[aM,aN].concat(k(aS)):[aM].concat(k(aS)));}});return aO;},aI={},az;av=ak(av.replace(/^( *\n)+/,""));while(av.valueOf()){av.save();if((az=U.exec(av))){av.advance(az[0]);aI[az[1]]=az[2];continue;}aG.linebreak();if((az=q.exec(av))){av.advance(az[0]);var aL=az[0],aw=Z(av,aL);if(aw){av.advance(aw[0]);aw=aw[1];}if((az=/\.(\.?)\s?/.exec(av))){var aE=!!az[1];az=(aE?Q:y).exec(av.advance(az[0]));av.advance(az[0]);if(aL==="bq"){var ay,aK=az[1];if((az=/^:(\S+)\s+/.exec(aK))){if(!aw){aw={};}aw.cite=az[1];aK=aK.slice(az[0].length);}aG.add(["blockquote",aw,"\n"].concat(aD(aK,"p",V(aw,{cite:1,id:1}),"\n")).concat(["\n"]));}else{if(aL==="bc"){var ax=(aw)?V(aw,{id:1}):null;aG.add(["pre",aw,(ax?["code",ax,az[1]]:["code",az[1]])]);}else{if(aL==="notextile"){aG.merge(d(az[1]));}else{if(aL==="###"){}else{if(aL==="pre"){aG.add(["pre",aw,az[1]]);}else{if(am.test(aL)){var aC=aL.replace(/\D+/g,"");if(!aw){aw={};}aw["class"]=(aw["class"]?aw["class"]+" ":"")+"footnote";aw.id="fn"+aC;aG.add(["p",aw,["a",{href:"#fnr"+aC},["sup",aC]]," ",az[1]]);}else{aG.merge(aD(az[1],aL,aw,"\n"));}}}}}}continue;}else{av.load();}}if((az=i.exec(av))){av.advance(az[0]+(/(?:\s*\n+)+/.exec(av)||[])[0]);aG.add(["!",az[1]]);continue;}if((az=aa.exec(av))){var aJ=az[1],aH=az[3]||aJ in ai,aF=az[4];if(aJ in c){av.advance(az[0]);var aB=[aJ];if(az[2]){aB.push(O(az[2]));}if(aH){aG.add(aB);continue;}else{var aA=ar.compile("^(.*?)(\\s*)(</"+aJ+"\\s*>)(\\s*)","s");if((az=aA.exec(av))){av.advance(az[0]);if(aJ==="pre"){aB.push(aF);aB=aB.concat(d(az[1].replace(/\n+$/,""),{code:1}));if(az[2]){aB.push(az[2]);}aG.add(aB);}else{if(aJ==="notextile"){aB=d(az[1].trim());aG.merge(aB);}else{if(aJ==="script"||aJ==="noscript"){aB.push(aF+az[1]);aG.add(aB);}else{if(/\n/.test(aF)){aB.push("\n");}if(/\n/.test(az[1])){aB=aB.concat(t(az[1]));}else{aB=aB.concat(k(az[1].replace(/^ +/,"")));}if(/\n/.test(az[2])){aB.push("\n");}aG.add(aB);}}}continue;}}}av.load();}if((az=m.exec(av))){av.advance(az[0]);aG.add(["hr"]);continue;}if((az=ac.exec(av))){av.advance(az[0]);aG.add(G(az[0]));continue;}if((az=H.exec(av))){av.advance(az[0]);aG.add(au(az[1]));continue;}az=y.exec(av);aG.merge(aD(az[1],"p",undefined,"\n"));av.advance(az[0]);}return aG.get().map(h,aI);}function h(ay){if(r(ay)){if(ay[0]==="a"){var av=ay[1];if(typeof av==="object"&&"href" in av&&av.href in this){av.href=this[av.href];}}for(var ax=1,aw=ay.length;ax<aw;ax++){if(r(ay[ax])){h.call(this,ay[ax]);}}}return ay;}function f(av,aw){g(aw);var ax=t(av).map(J.toHTML).join("");return ax;}f.parse=f.convert=f;f.html_parser=d;f.jsonml=function(av,aw){g(aw);return["html"].concat(t(av));};f.serialize=J.toHTML;f.setOptions=f.set_options=g;if(typeof module!=="undefined"&&module.exports){module.exports=f;}else{this.textile=f;}}).call(function(){return this||(typeof window!=="undefined"?window:global);}());